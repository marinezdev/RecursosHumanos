
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout _Administracion.cshtml";
}

<link rel="stylesheet" type="text/css" href="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.css">
<link rel="stylesheet" type="text/css" href="~/assets/icon/icofont/css/icofont.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />

<style>
    .fondo {
        background: linear-gradient(to right, #00bcd4, #c755db);
        color: #ffffff;
    }

    select.form-control, select.form-control:focus, select.form-control:hover {
        border-top: 1px;
        border-right: 1px;
        border-left: 1px;
        border: 1px solid #cccccc;
        border-radius: 2px;
    }

        select.form-control:not([size]):not([multiple]) {
            height: 36px;
        }

    .btn-save2 {
        border-color: #519f55;
        color: #4caf50;
        cursor: pointer;
        transition: all ease-in 0.3s;
        background: linear-gradient(to right, #efffdc, #dfffba);
        width: 60px;
        border-radius: 5px;
    }

    .btn-view {
        background: linear-gradient(to right, #fff7d5, #fff1c6);
        /* background-color: #ff5252; */
        border-color: #ffc107;
        color: #ff9800;
        cursor: pointer;
        -webkit-transition: all ease-in 0.3s;
        transition: all ease-in 0.3s;
        width: 60px;
        border-radius: 5px;
    }
</style>

<!-- Modal -->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Bitácora de vacante </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body " id="DivContenidoBitacora">
                <p class="text-center">No hay registro dentro de la bitácora </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar </button>
            </div>
        </div>
    </div>
</div>



<div class="main-body">
    <div class="page-wrapper">
        <!-- Page-body start -->
        <div class="page-body">

            <div class="row">
                <div class="col-xl-7 col-md-12">
                    <div class="row">
                        <div class="col-xl-12 col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Consulta </h5>
                                    <span class="text-muted">Selecciona los parámetros de la consulta .</span>
                                    <div class="card-header-right">
                                        <ul class="list-unstyled card-option">
                                            <li><i class="fa fa fa-wrench open-card-option"></i></li>
                                            <li><i class="fa fa-window-maximize full-card"></i></li>
                                            <li><i class="fa fa-minus minimize-card"></i></li>
                                            <li><i class="fa fa-refresh reload-card"></i></li>
                                            <li><i class="fa fa-trash close-card"></i></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <button class="btn btn-primary waves-effect waves-light col-md-4" onclick="FormularioUsuario()">Búsqueda por usuario</button>

                                        <button class="btn btn-primary waves-effect waves-light col-md-4" onclick="FormularioProyecto()">Búsqueda por proyectó</button>

                                        <div class="col-lg-12 col-xl-12">
                                            <input type="checkbox" id="checkbox_Usuario" value="0" style="display:none">
                                            <input type="checkbox" id="checkbox_Puesto" value="0" style="display:none">
                                        </div>
                                    </div>
                                    <hr />
                                    <div id="FormularioUsaurio" style="display:none">
                                        <h6 class="m-b-20 m-t-10 text-center"> Búsqueda por usuario </h6>
                                        <div class="row">

                                            <div class="col-md-12 col-lg-12">
                                                <div class="form-group">
                                                    <label for="largeInput">* Nombre usaurio  </label>
                                                    <select class="form-control" id="Select_Usuario" >
                                                        <option value="0">SELECCIONAR  </option>
                                                        @{
                                                            if (ViewBag.Usuarios != null)
                                                            {
                                                                foreach (var item1 in ViewBag.Usuarios)
                                                                {
                                                                    <option value="@item1.Usuarios.Id">@item1.Usuarios.Personas.Nombre @item1.Usuarios.Personas.ApPaterno @item1.Usuarios.Personas.ApMaterno </option>
                                                                }
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 col-lg-12">
                                                <button class="btn btn-primary waves-effect waves-light col-md-4" id="BtnConsultarUsuario"> Consultar </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="FormularioProyecto" style="display:none">
                                        <h6 class="m-b-20 m-t-10 text-center"> Búsqueda por proyectó </h6>
                                        <div class="row">
                                            <div class="col-md-6 col-lg-6">
                                                <div class="form-group">
                                                    <label for="largeInput">* Empresa   </label>
                                                    <select class="form-control" id="Select_Empresa_Empleado" onchange="CargaClientes(this.value)">
                                                        <option value="0">SELECCIONAR </option>
                                                        @foreach (var item1 in ViewBag.Empresas)
                                                        {
                                                            <option value="@item1.Id">@item1.RazonSocial.ToUpper()</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-6">
                                                <div class="form-group">
                                                    <label for="largeInput">Cliente   </label>
                                                    <select class="form-control" id="Select_Cliente_Empleado" onchange="CargaProyectosServicios(this.value)">
                                                        <option value="0">SELECCIONAR </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-6">
                                                <div class="form-group">
                                                    <label for="largeInput">Proyecto o servicio </label>
                                                    <select class="form-control" id="Select_Proyecto_Empleado">
                                                        <option value="0">SELECCIONAR </option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 col-lg-12">
                                                <button class="btn btn-primary waves-effect waves-light col-md-4" id="BtnConsultarProyecto"> Consultar </button>
                                            </div>
                                        </div>
                                    </div>



                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-md-12" style="display:none" id="EstatusVacantesGraficos">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Estatus vacantes </h5>
                                    <span class="text-muted">Grafica de porcentaje, vacantes registradas.</span>
                                    <div class="card-header-right">
                                        <ul class="list-unstyled card-option">
                                            <li><i class="fa fa fa-wrench open-card-option"></i></li>
                                            <li><i class="fa fa-window-maximize full-card"></i></li>
                                            <li><i class="fa fa-minus minimize-card"></i></li>
                                            <li><i class="fa fa-refresh reload-card"></i></li>
                                            <li><i class="fa fa-trash close-card"></i></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12">
                                            <div id="GraficaPocentaje" style="height: 180px" class="text-center">
                                                <img src="~/Images/icons/loading__.gif" width="100%" height="100%" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>


                </div>

                <div class="col-xl-5 col-md-12" style="display:none" id="PorcentajesGraficos">
                    <div class="row">

                        <div class="col-xl-12 col-md-12">
                            <div class="card" onclick="Consulta(7);">
                                <div class="card-block">
                                    <div class="row align-items-center">
                                        <div class="col-8">
                                            <h4 class="" id="ProspectosRegistrados">0</h4>
                                            <h6 class="text-muted m-b-0">Prospectos registrados </h6>
                                        </div>
                                        <div class="col-4 text-right">
                                            <i class="fa fa-users f-28"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-c-blue fondo">
                                    <div class="row align-items-center">
                                        <div class="col-9">
                                            <p class="text-white m-b-0">% Prospectos</p>
                                        </div>
                                        <div class="col-3 text-right">
                                            <i class="fa fa-th-list text-white f-16"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-md-12">
                            <div class="card" onclick="Consulta(7);">
                                <div class="card-block">
                                    <div class="row align-items-center">
                                        <div class="col-8">
                                            <h4 class="" id="ProspectosEnProceso">0</h4>
                                            <h6 class="text-muted m-b-0">Prospectos en proceso </h6>
                                        </div>
                                        <div class="col-4 text-right">
                                            <i class="fa fa-users f-28"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer bg-c-blue fondo">
                                    <div class="row align-items-center">
                                        <div class="col-9">
                                            <p class="text-white m-b-0">% Prospectos</p>
                                        </div>
                                        <div class="col-3 text-right">
                                            <i class="fa fa-th-list text-white f-16"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Estatus prospectos </h5>
                                    <span class="text-muted">Grafica de porcentaje, prospectos registrados.</span>
                                    <div class="card-header-right">
                                        <ul class="list-unstyled card-option">
                                            <li><i class="fa fa fa-wrench open-card-option"></i></li>
                                            <li><i class="fa fa-window-maximize full-card"></i></li>
                                            <li><i class="fa fa-minus minimize-card"></i></li>
                                            <li><i class="fa fa-refresh reload-card"></i></li>
                                            <li><i class="fa fa-trash close-card"></i></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12">
                                            <div id="GraficaPocentajeProspectos" style="height: 180px" class="text-center">
                                                <img src="~/Images/icons/loading__.gif" width="100%" height="100%" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>


            </div>

            <div class="row" style="display:none" id="ListaVacantesRegistradas">
                <div class="col-xl-12 col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Vacantes </h5>
                            <span class="text-muted">Lista de vacantes registradas.</span>
                            <div class="card-header-right">
                                <ul class="list-unstyled card-option">
                                    <li><i class="fa fa fa-wrench open-card-option"></i></li>
                                    <li><i class="fa fa-window-maximize full-card"></i></li>
                                    <li><i class="fa fa-minus minimize-card"></i></li>
                                    <li><i class="fa fa-refresh reload-card"></i></li>
                                    <li><i class="fa fa-trash close-card"></i></li>
                                </ul>
                            </div>
                        </div>
                        <div class="card-block">
                            <div class="row" id="TablaVacantes">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.min.js"></script>
<script src="~/assets/js/bootstrap-notify/bootstrap-notify.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="~/Vendor/chart.js/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>

<script>
    
    $('#BtnConsultarProyecto').click(function () {
        $("#ListaVacantesRegistradas").css("display", "none");
        $("#PorcentajesGraficos").css("display", "none");
        $("#EstatusVacantesGraficos").css("display", "none");

        if (ValidaForm()) {
            var _Cliente = $("#Select_Cliente_Empleado option:selected").val();
            var _Proyecto = $("#Select_Proyecto_Empleado option:selected").val();

            if (_Proyecto == 0) {
                var Cat_Clientes = new Object();
                Cat_Clientes.Id = _Cliente;

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Vacante_Seleccionar_IdCliente", "Vacantes")",
                    async: false,
                    data: JSON.stringify(Cat_Clientes),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $("#BtnConsultarUsuario").prop("disabled", false);

                        $("#ListaVacantesRegistradas").show();
                        $("#PorcentajesGraficos").show();
                        $("#EstatusVacantesGraficos").show();

                        PintaTabla(result);
                    },
                    error: function () {
                        swal({
                            title: "No se encontraron Vacantes ",
                            text: "No se encontró ningún registro!",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        }).then((willDelete) => {

                        });
                    }
                });


                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Vacante_Estatus_IdCliente", "Vacantes")",
                    async: false,
                    data: JSON.stringify(Cat_Clientes),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $('#GraficaPocentaje').html('');
                        $('#GraficaPocentaje').html('<canvas id="densityChartEstatus" width="100%" height="200"></canvas>');
                        PintaEstatusVacantes(result);

                    },
                    error: function () {

                    }
                });


                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Vacante_Estatus_Prospectos_IdCliente", "Vacantes")",
                    async: false,
                    data: JSON.stringify(Cat_Clientes),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $('#GraficaPocentajeProspectos').html('');
                        $('#GraficaPocentajeProspectos').html('<canvas id="densityChartEstatusProspectos" width="100%" height="200"></canvas>');
                        PintaEstatusProspectos(result);

                    },
                    error: function () {
                        $('#GraficaPocentajeProspectos').html('');
                    }
                });

            } else {
                var Cat_ProyectoServicios = new Object();
                Cat_ProyectoServicios.Id = _Proyecto;
                Cat_ProyectoServicios.IdCliente = _Cliente;

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Vacante_Seleccionar_IdProyecto", "Vacantes")",
                    async: false,
                    data: JSON.stringify(Cat_ProyectoServicios),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $("#BtnConsultarUsuario").prop("disabled", false);

                        $("#ListaVacantesRegistradas").show();
                        $("#PorcentajesGraficos").show();
                        $("#EstatusVacantesGraficos").show();

                        PintaTabla(result);
                    },
                    error: function () {
                        swal({
                            title: "No se encontraron Vacantes ",
                            text: "No se encontró ningún registro!",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        }).then((willDelete) => {

                        });
                    }
                });


                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Vacante_Estatus_IdProyecto", "Vacantes")",
                    async: false,
                    data: JSON.stringify(Cat_ProyectoServicios),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $('#GraficaPocentaje').html('');
                        $('#GraficaPocentaje').html('<canvas id="densityChartEstatus" width="100%" height="200"></canvas>');
                        PintaEstatusVacantes(result);

                    },
                    error: function () {

                    }
                });


                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Vacante_Estatus_Prospectos_IdProyecto", "Vacantes")",
                    async: false,
                    data: JSON.stringify(Cat_ProyectoServicios),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        $('#GraficaPocentajeProspectos').html('');
                        $('#GraficaPocentajeProspectos').html('<canvas id="densityChartEstatusProspectos" width="100%" height="200"></canvas>');
                        PintaEstatusProspectos(result);

                    },
                    error: function () {
                        $('#GraficaPocentajeProspectos').html('');
                    }
                });

            }
        }
        else {
            swal({
                title: "Formulario incompleto ",
                text: "Completa los campos marcados. !",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {

            });
        }
    });

    function ValidaForm() {
        var result = false;

        $('#Select_Empresa_Empleado').css("border", "1px solid #f44336");

        if ($("#Select_Empresa_Empleado option:selected").val() > 0) {
            $('#Select_Empresa_Empleado').css("border", "1px solid #cccccc");
        }


        $('#Select_Cliente_Empleado').css("border", "1px solid #f44336");

        if ($("#Select_Cliente_Empleado option:selected").val() > 0) {
            $('#Select_Cliente_Empleado').css("border", "1px solid #cccccc");
        }

        if ($("#Select_Empresa_Empleado option:selected").val() > 0) {
            if ($("#Select_Cliente_Empleado option:selected").val() > 0) {
                result = true;
            }
        }

        return result;
    }

</script>

<script>
    $('#BtnConsultarUsuario').click(function () {
        $("#ListaVacantesRegistradas").css("display", "none");
        $("#PorcentajesGraficos").css("display", "none");
        $("#EstatusVacantesGraficos").css("display", "none");

        if ($("#Select_Usuario option:selected").val() > 0) {
            $("#BtnConsultarUsuario").prop("disabled", true);


            var Usuarios = new Object();
            Usuarios.Id = $("#Select_Usuario option:selected").val();
            var Vacante = new Object();
            Vacante.Usuarios = Usuarios;

            $.ajax({
                type: "POST",
                url: "@Url.Action("Vacante_Seleccionar_IdUsuario", "Vacantes")",
                async: false,
                data: JSON.stringify(Vacante),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $("#BtnConsultarUsuario").prop("disabled", false);

                    $("#ListaVacantesRegistradas").show();
                    $("#PorcentajesGraficos").show();
                    $("#EstatusVacantesGraficos").show();

                    PintaTabla(result);
                },
                error: function () {
                    swal({
                        title: "No se encontraron Vacantes ",
                        text: "No se encontró ningún registro!",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                    }).then((willDelete) => {

                    });
                }
            });


            $.ajax({
                type: "POST",
                url: "@Url.Action("Vacante_Estatus_IdUsuario", "Vacantes")",
                async: false,
                data: JSON.stringify(Vacante),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $('#GraficaPocentaje').html('');
                    $('#GraficaPocentaje').html('<canvas id="densityChartEstatus" width="100%" height="200"></canvas>');
                    PintaEstatusVacantes(result);

                },
                error: function () {
                    swal({
                        title: "Problemas en la solicitud",
                        text: "Consulta denegada!",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                    }).then((willDelete) => {

                    });
                }
            });


            $.ajax({
                type: "POST",
                url: "@Url.Action("Vacante_Estatus_Prospectos_IdUsuario", "Vacantes")",
                async: false,
                data: JSON.stringify(Vacante),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $('#GraficaPocentajeProspectos').html('');
                    $('#GraficaPocentajeProspectos').html('<canvas id="densityChartEstatusProspectos" width="100%" height="200"></canvas>');
                    PintaEstatusProspectos(result);

                },
                error: function () {
                    $('#GraficaPocentajeProspectos').html('');
                }
            });


        } else {
            swal({
                title: "Formulario incompleto ",
                text: "Selecciona un usuario para realizar la consulta. !",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {

            });
        }
    });

    function PintaEstatusProspectos(dbData) {
        console.log(dbData);
        const Nombres = [];
        const Totales = [];
        var ProspectosEnProceso = 0;

        for (var b = 0; b < dbData.length; b++) {
            Nombres.push(dbData[b].Nombre);
            Totales.push(dbData[b].Total);

            if (dbData[b].Nombre == "EN PROCESO") {
                ProspectosEnProceso += 1;
            }

        }

        $("#ProspectosEnProceso").text(ProspectosEnProceso);
        $("#ProspectosRegistrados").text(dbData.length);



        //var avence = respuesta.Total;
        //var faltante = respuesta.Total - 100.00;

        var densityCanvas = document.getElementById("densityChartEstatusProspectos");

        Chart.defaults.global.defaultFontFamily = "Arial, sans-serifapple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif";
        Chart.defaults.global.defaultFontSize = 14;

        var densityData = {
            label: 'Estatus',

            options: {
                legend: {
                    labels: {
                        // This more specific font property overrides the global property
                        //fontColor: 'black',
                        defaultFontFamily: 'Arial, sans-serifapple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif',
                        fontColor: 'rgb(154, 154, 154)',
                        usePointStyle: true,
                    }
                }
            },

            data: Totales,
            backgroundColor: ["#00bcd4", "#6389d8", "#8976d9", "#a865da", "#c556db"],
            borderWidth: 1,
            hoverBorderWidth: 0,
            hoverBackgroundColor: ["#00a2b7", "#3d5c9b", "#5e5097", "#643c81", "#7b3689"],
        };

        var chartOptions = {
            responsive: true,
            maintainAspectRatio: false
        };

        var barChart = new Chart(densityCanvas, {
            type: 'doughnut',
            data: {
                labels: Nombres,
                datasets: [densityData],
            },
            options: chartOptions
        });
    }

    function PintaEstatusVacantes(dbData) {
        console.log(dbData);
        const Nombres = [];
        const Totales = [];

        for (var b = 0; b < dbData.length; b++) {
            Nombres.push(dbData[b].Nombre);
            Totales.push(dbData[b].Total);
        }

        //var avence = respuesta.Total;
        //var faltante = respuesta.Total - 100.00;

        var densityCanvas = document.getElementById("densityChartEstatus");

        Chart.defaults.global.defaultFontFamily = "Arial, sans-serifapple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif";
        Chart.defaults.global.defaultFontSize = 14;

        var densityData = {
            label: 'Estatus',

            options: {
                legend: {
                    labels: {
                        // This more specific font property overrides the global property
                        //fontColor: 'black',
                        defaultFontFamily: 'Arial, sans-serifapple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif',
                        fontColor: 'rgb(154, 154, 154)',
                        usePointStyle: true,
                    }
                }
            },

            data: Totales,
            backgroundColor: ["#00bcd4", "#6389d8", "#8976d9", "#a865da","#c556db"],
            borderWidth: 1,
            hoverBorderWidth: 0,
            hoverBackgroundColor: ["#00a2b7", "#3d5c9b", "#5e5097", "#643c81","#7b3689"],
        };

        var chartOptions = {
            responsive: true,
            maintainAspectRatio: false
        };

        var barChart = new Chart(densityCanvas, {
            type: 'doughnut',
            data: {
                labels: Nombres,
                datasets: [densityData],
            },
            options: chartOptions
        });

    }

    function PintaTabla(data) {

        var Table =
            "<div class='col-lg-12'>" +
                "<div class='table-responsive text-nowrap'>" +
                    "<table class='table table-hover table-striped text-center' id='TableListaVacantes'>" +
                        "<thead>" +
                            "<tr>" +
                                "<th class='text-center'>Titulo  </th>" +
                                "<th class='text-center'>Fecha registro</th>" +
                                "<th class='text-center'>Prospectos </th>" +
                                "<th class='text-center'>Días trascurridos </th>" +
                                "<th class='text-center'>Fecha cierre </th>" +
                                "<th class='text-center'>Estatus </th>" +
                                "<th class='text-center'> </th>" +
                            "</tr>" +
                        "</thead>" +
                         "<tbody>";
        for (var b = 0; b < data.length; b++) {
            Table += "<tr class='text-center'>" +
                        "<td>" + data[b].Titulo + "</td>" +
                        "<td>" + FormatoFechaTabla(data[b].FechaRegistro) + " </td>" +
                        "<td>" + data[b].Prospecto + "</td>" +
                        "<td> " + data[b].Tiempo + "</td>" +
                        "<td>";
                            if (data[b].FechaCierre == "/Date(-62135575200000)/") {

                            } else {
                                Table += FormatoFechaTabla(data[b].FechaCierre);
                            }
                    Table += "</td>" +
                         "<td>" + data[b].Cat_EstatusVacante.Nombre + "</td>" +
                        "<td>" +
                            "<button class='btn waves-effect btn-save2 waves-light' onclick='MostrarBitacora(" + data[b].Id + ")' data-toggle='tooltip' data-placement='top' title='' data-original-title='Editar'><i class='fa fa-file-text'></i></button>" +
                            "<button class='btn waves-effect btn-view waves-light ' data-toggle='tooltip' data-placement='top' title='' onclick='MostrarVacante(" + data[b].Id + ")' data-original-title='Eliminar registro'><i class='fa fa-eye'></i></button>" +
                        "</td>" +
                      "</tr>";
        }

        Table += "</tbody>" +
                "</table>" +
               "</div>" +
            "</div>";

        $("#TablaVacantes").html(Table);

        

        
        //$('#TableListaVacantes').DataTable({
        //    columnDefs: [
        //        //{
        //        //    targets: [1], visible: true, searchable: false, orderable: true,
        //        //    render: function (value) {
        //        //        if (value === null) return "";
        //        //        var pattern = /Date\(([^)]+)\)/; //date format from server side
        //        //        var results = pattern.exec(value);
        //        //        var dt = new Date(parseFloat(results[1]));
        //        //        if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
        //        //        return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
        //        //    }
        //        //},
        //        //{
        //        //    targets: [4], visible: true, searchable: false, orderable: true,
        //        //    render: function (value) {
        //        //        if (value.length == 0) {
        //        //            return "";
        //        //        } else {
        //        //            var pattern = /Date\(([^)]+)\)/; //date format from server side
        //        //            var results = pattern.exec(value);
        //        //            var dt = new Date(parseFloat(results[1]));
        //        //            if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
        //        //            return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
        //        //        }
        //        //    }
        //        //},
        //    ],
        //    "language": {
        //        "url": "//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json"
        //    }
        //});
    }

    function FormatoFechaTabla(value) {
        var pattern = /Date\(([^)]+)\)/; //date format from server side
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        if (dt.getFullYear() === 9999) return ""; //Control para MaxValue
        return (dt.getFullYear()) + "-" + ('0' + (dt.getMonth() + 1)).slice(-2) + "-" + ('0' + dt.getDate()).slice(-2);
    }

    function CargaDatable() {
        $('#TableListaVacantes').DataTable();
    }

    function MostrarBitacora(Id) {
        $("#exampleModalLong").modal("show");

        var Vacante = new Object();
        Vacante.Id = Id;

        $.ajax({
            type: "POST",
            url: "@Url.Action("VacanteBitacora_Seleccionar_IdVacante", "VacanteBitacora")",
            async: false,
            data: JSON.stringify(Vacante),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {

                var table = "<div class='row'>" +
                                "<div class='col-md-12' id=''>" +
                                    "<div class='demo-inline-spacing mt-3'>" +
                                        "<div class='list-group'>";
                for (var b = 0; b < data.length; b++) {

                    table +=           "<a href='javascript:void(0);' class='list-group-item list-group-item-action flex-column align-items-start'>" +
                                            "<div class='d-flex justify-content-between w-100'>" +
                                                "<h6>" + data[b].Cat_Operacion.Nombre+ "</h6>" +
                                                "<small class='text-muted'>" + moment(data[b].FechaRegistro).format('YYYY-MM-DD')  + "</small>" +
                                            "</div>" +
                                            "<p class='mb-1'>" +
                                            "<strong>" + data[b].Usuarios.Personas.Nombre + "  " + data[b].Usuarios.Personas.ApMaterno + " " + data[b].Usuarios.Personas.ApMaterno + "</strong>" + data[b].Nota +
                                            "</p>" +
                                                "<small class='text-muted'>" + moment(data[b].FechaRegistro).format('YYYY-MM-DD') + "</small>" +
                                        "</a>";
                                    }
                    table +=            "</div>" +
                                    "</div>" +
                                "</div>" +
                    "</div>";
                if (data.length > 0) {
                    $("#DivContenidoBitacora").html(table);
                } else {
                    $("#DivContenidoBitacora").html("<p class='text-center'>No hay registro dentro de la bitácora </p>");
                }

            },
            error: function () {

                $("#DivContenidoBitacora").html("<p class='text-center'>No hay registro dentro de la bitácora </p>");
            }
        });

    }

    function MostrarVacante(num)
    {
        window.location.href = '@Url.Action("Vacante", "Vacantes")?Id=' + num;
    }
</script>

<script>
    function FormularioProyecto() {
        $("#ListaVacantesRegistradas").css("display", "none");
        $("#PorcentajesGraficos").css("display", "none");
        $("#EstatusVacantesGraficos").css("display", "none");

        $("#checkbox_Usuario").prop("checked", false);

        if ($('#checkbox_Puesto').prop('checked')) {

            $("#checkbox_Puesto").prop("checked", false);
            $("#FormularioProyecto").css("display", "none");

        } else {
            $("#checkbox_Puesto").prop("checked", true);


            $("#FormularioProyecto").show();
            $("#FormularioUsaurio").css("display", "none");

            var posicion = $("#FormularioProyecto").offset().top;
            $("html, body").animate({
                scrollTop: posicion - 100
            }, 500);
        }
    }

    function FormularioUsuario() {
        $("#ListaVacantesRegistradas").css("display", "none");
        $("#PorcentajesGraficos").css("display", "none");
        $("#EstatusVacantesGraficos").css("display", "none");

        $("#checkbox_Puesto").prop("checked", false);
        if ($('#checkbox_Usuario').prop('checked')) {

            $("#checkbox_Usuario").prop("checked", false);
            $("#FormularioUsaurio").css("display", "none");

        } else {
            $("#checkbox_Usuario").prop("checked", true);
            $("#FormularioUsaurio").show();
            $("#FormularioProyecto").css("display", "none");

            var posicion = $("#FormularioUsaurio").offset().top;
            $("html, body").animate({
                scrollTop: posicion - 100
            }, 500);
        }
    }
</script>


<script>
    function CargaClientes(valor) {
        if (valor > 0) {

            var Empresas = new Object();
            Empresas.Id = valor;

            $.ajax({
                type: "POST",
                url: "@Url.Action("Cat_Clientes_Listar_IdEmpresa", "Clientes")",
                data: JSON.stringify(Empresas),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $("#Select_Cliente_Empleado").empty();

                    var option = $(document.createElement('option'));
                    option.text("SELECCIONAR");
                    option.val(0);

                    $("#Select_Cliente_Empleado").append(option);

                    if (result.length > 0) {
                        $(result).each(function () {
                            var option = $(document.createElement('option'));

                            option.text(this.Nombre.toUpperCase());
                            option.val(this.Id);

                            $("#Select_Cliente_Empleado").append(option);
                        });
                    }
                },
                error: errores
            });

        }
    }

    function CargaProyectosServicios(valor)
    {
        if ($('#Select_Cliente_Empleado option:selected').val() > 0) {
            $('#Select_Cliente_Empleado').css("border", "1px solid #cccccc");
        } else {
            $('#Select_Cliente_Empleado').css("border", "1px solid #f44336");
        }

        if (valor > 0) {

            var obj = {};
            obj['IdCliente'] = valor;

            var jsonObject = {
                "Cat_ProyectoServicios": obj
            };

            $.ajax({
                type: "POST",
                url: "@Url.Action("ProyectoServicios_Listar", "ProyectoServicios")",
                data: JSON.stringify(jsonObject),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (result) {
                    $("#Select_Proyecto_Empleado").empty();

                    var option = $(document.createElement('option'));
                    option.text("SELECCIONAR");
                    option.val(0);

                    $("#Select_Proyecto_Empleado").append(option);


                    if (result.length > 0) {


                        $(result).each(function () {
                            var option = $(document.createElement('option'));

                            option.text(this.Nombre.toUpperCase());
                            option.val(this.Id);

                            $("#Select_Proyecto_Empleado").append(option);
                        });

                    }
                },
                error: errores
            });

        }
    }

    function errores() {
        $.notify({
            message: "Inténtelo mas tarde."
        }, {
            type: 'danger',
            allow_dismiss: false,
            animate: {
                enter: 'animated rollIn',
                exit: 'animated rollOut'
            }
        });
    }

</script>

<script>
    $('#IdMenuVacantes').addClass("active pcoded-trigger");
    $('#IdSubMenuVacanteConsulta').addClass("active pcoded-trigger");
    $('#IdSubMenuVacanteConsultaIndividual').addClass("active");



    function formatDate(dateString) {
        // Parse the date string into a Date object
        const date = new Date(dateString);

        // Convert the Date object to a formatted string
        const formattedDate = date.toLocaleDateString();

        // Return the formatted date string
        return formattedDate;
    }
</script>
